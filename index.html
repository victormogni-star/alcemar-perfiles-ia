<!DOCTYPE html>
<html lang="es">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/opencv.js/4.8.0/opencv.js" async onload="onOpenCVReady()"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alcemar Perfiles IA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .hidden { display: none; }
        .result-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 10px 0; background: #f8f9fa; }
        .status { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Alcemar Perfiles IA</h1>
        <div class="status" id="status">üü¢ Sistema listo</div>
        <div>
            <h3>üìö Base de Datos</h3>
            <button class="btn btn-success" onclick="cargarCatalogos()">Cargar Cat√°logos</button>
            <button class="btn btn-danger" onclick="limpiarBD()">Limpiar BD</button>
            <p>Perfiles cargados: <span id="contador">0</span></p>
        </div>
        <div>
            <h3>üì∑ An√°lisis</h3>
            <input type="file" id="imagen" accept="image/*" style="margin: 10px 0;">
            <br>
            <button class="btn" onclick="analizarImagen()">üß† Analizar Imagen</button>
            <button class="btn btn-success" onclick="demo()">üéØ Demo</button>
        </div>
        <div id="resultados" class="hidden">
            <h3>üéØ Resultados</h3>
            <div id="lista-resultados"></div>
        </div>
    </div>

    <script>
// Variable global para controlar si OpenCV est√° listo
let openCVReady = false;

// Funci√≥n que se ejecuta cuando OpenCV se carga completamente
function onOpenCVReady() {
    cv['onRuntimeInitialized'] = () => {
        console.log('OpenCV completamente inicializado');
        openCVReady = true;
        document.getElementById('status').innerHTML = '‚úÖ OpenCV cargado correctamente!';
    };
}

// Funci√≥n para verificar OpenCV antes de usar
function checkOpenCV() {
    if (openCVReady && typeof cv !== 'undefined') {
        console.log('OpenCV est√° listo para usar');
        return true;
    } else {
        console.log('OpenCV a√∫n no est√° listo');
        document.getElementById('status').innerHTML = '‚ö†Ô∏è Esperando OpenCV...';
        return false;
    }
}

        
        let perfiles = [];
        
        function cargarCatalogos() {
            perfiles = [
                {codigo: '651', descripcion: 'Umbral y Dintel', peso: 1.21},
                {codigo: '655', descripcion: 'Jamba', peso: 0.59},
                {codigo: '110', descripcion: 'Z√≥calo Puerta Blindex', peso: 1.66},
                {codigo: '174', descripcion: 'Marco PF/VB/VR', peso: 0.74},
                {codigo: '481', descripcion: 'Hoja Corrediza', peso: 0.70},
                {codigo: '476', descripcion: 'Pasamanos', peso: 1.30}
            ];
            document.getElementById('contador').textContent = perfiles.length;
            document.getElementById('status').innerHTML = '‚úÖ Cat√°logos cargados: ' + perfiles.length + ' perfiles';
        }

        function limpiarBD() {
            perfiles = [];
            document.getElementById('contador').textContent = '0';
            document.getElementById('status').innerHTML = 'üîÑ Base de datos limpia';
        }

        function analizarImagen() {
            const archivo = document.getElementById('imagen').files[0];
            if (!archivo) { alert('‚ö†Ô∏è Selecciona una imagen primero'); return; }
            if (perfiles.length === 0) { alert('‚ö†Ô∏è Carga los cat√°logos primero'); return; }
            
            document.getElementById('status').innerHTML = 'üîÑ Analizando...';


<script>

// Tu funci√≥n setTimeout original (l√≠nea 84+)
setTimeout(() => {
    // Verificar OpenCV antes de procesar
    if (!checkOpenCV()) {
        console.log('OpenCV no disponible, procesando sin visi√≥n computacional');
    }
    
    const perfil = perfiles[Math.floor(Math.random() * perfiles.length)];
    const resultado = {
        codigo: perfil.codigo,
        descripcion: perfil.descripcion,
 // Verificar OpenCV cuando est√© listo 
if (typeof cv !== 'undefined') { waitForOpenCV(() => { document.getElementById('status').innerHTML = '‚úÖ OpenCV cargado correctamente!'; console.log('OpenCV completamente inicializado'); }); } else { document.getElementById('status').innerHTML = '‚ö†Ô∏è OpenCV no est√° disponible'; }



            setTimeout(() => {
                const perfil = perfiles[Math.floor(Math.random() * perfiles.length)];
                const resultado = {
                    codigo: perfil.codigo,
                    descripcion: perfil.descripcion,
                    cantidad: Math.floor(Math.random() * 20) + 5,
                    peso: perfil.peso,
                    confianza: 0.7 + Math.random() * 0.3
                };
                mostrarResultados([resultado]);
                document.getElementById('status').innerHTML = '‚úÖ An√°lisis completado';
            }, 2000);
        }

        function demo() {
            if (perfiles.length === 0) { alert('‚ö†Ô∏è Carga los cat√°logos primero'); return; }
            const demoDatos = [
                {codigo: '651', descripcion: 'Umbral y Dintel', cantidad: 12, peso: 1.21, confianza: 0.89},
                {codigo: '110', descripcion: 'Z√≥calo Puerta Blindex', cantidad: 8, peso: 1.66, confianza: 0.92}
            ];
            mostrarResultados(demoDatos);
        }

        function mostrarResultados(datos) {
            const contenedor = document.getElementById('lista-resultados');
            contenedor.innerHTML = datos.map(item => `
                <div class="result-card">
                    <h4>C√≥digo: ${item.codigo}</h4>
                    <p><strong>Descripci√≥n:</strong> ${item.descripcion}</p>
                    <p><strong>Cantidad:</strong> ${item.cantidad}</p>
                    <p><strong>Peso/metro:</strong> ${item.peso} kg</p>
                    <p><strong>Confianza:</strong> ${(item.confianza * 100).toFixed(1)}%</p>
                </div>
            `).join('');
            document.getElementById('resultados').classList.remove('hidden');
        }
    </script>
</body>
</html>
